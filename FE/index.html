<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Toolkit v2.0</title>

    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">

    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">

    <style>
        /* Custom styles for toggle switch if needed, or use a library */
        .toggle-checkbox:checked+.toggle-label {
            background-color: #3b82f6;
            /* Tailwind blue-500 */
        }

        .toggle-checkbox:checked+.toggle-label .toggle-ball {
            transform: translateX(100%);
        }

        .toggle-label {
            transition: background-color 0.2s ease-in-out;
        }

        .toggle-ball {
            transition: transform 0.2s ease-in-out;
        }

        /* Radio button custom styles for better UX */
        .summary-radio-group input[type="radio"]:checked+label {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }

        /* Smooth transitions for conditional UI */
        .slide-down-enter {
            max-height: 0;
            opacity: 0;
        }

        .slide-down-enter-active {
            max-height: 200px;
            opacity: 1;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        }
    </style>
</head>

<body class="h-full bg-gray-50 font-sans antialiased" x-data="app()" x-init="initApp()">

    <header class="header-nav fixed top-0 left-0 right-0 z-50 px-4 sm:px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between max-w-screen-2xl mx-auto">

            <div class="flex items-center space-x-3">
                <i class="fas fa-cube text-blue-600 text-xl"></i>
                <h1 class="text-lg sm:text-xl font-bold text-gray-800">Enhanced Toolkit</h1>
                <span class="hidden sm:inline px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">v2.0</span>
            </div>

            <nav class="flex space-x-1">
                <button @click="activeTab = 'image-search'"
                    :class="activeTab === 'image-search' ? 'tab-button active' : 'tab-button'"
                    class="px-3 sm:px-6 py-2 font-medium rounded-t-lg transition-colors text-sm sm:text-base">
                    <i class="fas fa-search mr-1 sm:mr-2"></i>
                    <span class="hidden sm:inline">Image Search</span>
                    <span class="sm:hidden">Search</span>
                </button>
                <button @click="activeTab = 'document-summary'"
                    :class="activeTab === 'document-summary' ? 'tab-button active' : 'tab-button'"
                    class="px-3 sm:px-6 py-2 font-medium rounded-t-lg transition-colors text-sm sm:text-base">
                    <i class="fas fa-file-text mr-1 sm:mr-2"></i>
                    <span class="hidden sm:inline">Document Summary</span>
                    <span class="sm:hidden">Docs</span>
                </button>
            </nav>

            <div class="flex items-center space-x-2 sm:space-x-4">
                <div class="hidden lg:block text-sm text-gray-500" x-text="statusMessage"></div>
                <button @click="performFullCleanup()" title="Cleanup Temporary Files"
                    class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-broom"></i>
                </button>
                <button class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="pt-16 sm:pt-20 pb-12 sm:pb-16 min-h-full">

        <div x-show="activeTab === 'image-search'" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            class="h-full flex flex-col lg:flex-row">

            <div
                class="w-full lg:w-1/3 bg-white border-b lg:border-b-0 lg:border-r border-gray-200 p-4 sm:p-6 overflow-y-auto">
                <div class="space-y-6">

                    <div x-show="!selectedImage" class="upload-area p-6 sm:p-8 text-center" @click="browseImageFiles()"
                        @dragover.prevent="$el.classList.add('drag-active')"
                        @dragleave.prevent="$el.classList.remove('drag-active')"
                        @drop.prevent="handleImageDrop($event); $el.classList.remove('drag-active')">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload text-3xl sm:text-4xl text-gray-400 mb-4"></i>
                        </div>
                        <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-2">Upload Image</h3>
                        <p class="text-sm text-gray-500 mb-4">Drag and drop an image here or click to browse</p>
                        <div class="flex justify-center">
                            <button class="btn btn-primary" type="button">
                                <i class="fas fa-folder-open mr-2"></i>
                                Browse Files
                            </button>
                        </div>
                    </div>

                    <div x-show="selectedImage" class="card p-4">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="font-medium text-gray-900">Selected Image</h3>
                            <button @click="removeSelectedImage()"
                                class="text-gray-400 hover:text-red-500 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div
                            class="mb-3 bg-gray-100 rounded-lg overflow-hidden aspect-video flex items-center justify-center">
                            <img x-show="selectedImage" :src="selectedImage?.preview" :alt="selectedImage?.name"
                                class="max-w-full max-h-full object-contain">
                        </div>

                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-500">Name:</span>
                                <span class="font-medium text-gray-900 truncate ml-2"
                                    x-text="selectedImage?.name"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Size:</span>
                                <span class="font-medium text-gray-900"
                                    x-text="selectedImage ? formatFileSize(selectedImage.size) : ''"></span>
                            </div>
                        </div>
                    </div>

                    <div x-show="selectedImage && visionCapabilities.available" class="card p-4">
                        <h4 class="font-medium text-gray-900 mb-3 flex items-center">
                            <i class="fas fa-eye mr-2 text-blue-600"></i> Vision Analysis
                        </h4>
                        <div class="space-y-3">
                            <div>
                                <label for="visionLanguage"
                                    class="block text-sm font-medium text-gray-600">Language</label>
                                <select id="visionLanguage" x-model="visionSettings.language"
                                    class="form-input w-full text-sm py-1.5 focus-ring mt-1">
                                    <option value="vietnamese">Vietnamese</option>
                                    <option value="english">English</option>
                                </select>
                            </div>
                            <div>
                                <label for="visionDetailLevel" class="block text-sm font-medium text-gray-600">Detail
                                    Level</label>
                                <select id="visionDetailLevel" x-model="visionSettings.detailLevel"
                                    class="form-input w-full text-sm py-1.5 focus-ring mt-1">
                                    <option value="brief">Brief</option>
                                    <option value="detailed">Detailed</option>
                                    <option value="extensive">Extensive</option>
                                </select>
                            </div>
                            <label class="flex items-center space-x-2 cursor-pointer p-1 hover:bg-gray-50 rounded-md">
                                <input type="checkbox" x-model="visionSettings.autoAnalyze"
                                    class="form-checkbox text-blue-600 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Auto-analyze on upload</span>
                            </label>
                            <button class="btn btn-secondary w-full" @click="analyzeImageWithVision()"
                                :disabled="visionState.isAnalyzing || !visionCapabilities.apiConfigured">
                                <span x-show="!visionState.isAnalyzing"><i
                                        class="fas fa-wand-magic-sparkles mr-2"></i>Describe Image</span>
                                <span x-show="visionState.isAnalyzing" class="flex items-center justify-center">
                                    <div
                                        class="animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent mr-2">
                                    </div>
                                    Analyzing...
                                </span>
                            </button>
                            <p x-show="!visionCapabilities.apiConfigured"
                                class="text-xs text-center text-yellow-600 bg-yellow-100 p-2 rounded-md">
                                Vision API key not configured.
                            </p>
                        </div>
                        <div x-show="visionState.isAnalyzing" class="space-y-2 pt-3">
                            <div class="progress-container">
                                <div class="progress-bar" :style="'width: ' + visionState.progress + '%'"></div>
                            </div>
                            <p class="text-xs text-gray-600 text-center" x-text="visionState.status"></p>
                        </div>
                    </div>

                    <div x-show="selectedImage" class="card p-4">
                        <h4 class="font-medium text-gray-900 mb-3 flex items-center">
                            <i class="fas fa-info-circle mr-2 text-indigo-600"></i> Image Metadata
                        </h4>
                        <div class="space-y-3">
                            <label class="flex items-center space-x-2 cursor-pointer p-1 hover:bg-gray-50 rounded-md">
                                <input type="checkbox" x-model="metadataSettings.autoAnalyze" class="form-checkbox text-blue-600 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Auto-analyze on upload</span>
                            </label>
                            <button class="btn btn-secondary w-full" @click="analyzeImageMetadata()" :disabled="metadataState.isAnalyzing">
                                <span x-show="!metadataState.isAnalyzing"><i class="fas fa-chart-bar mr-2"></i>Analyze Metadata</span>
                                <span x-show="metadataState.isAnalyzing" class="flex items-center justify-center">
                                    <div class="animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent mr-2"></div>
                                    Processing...
                                </span>
                            </button>
                        </div>
                        <div x-show="metadataState.error" class="text-xs text-red-700 bg-red-100 p-2 mt-2 rounded-md" x-text="metadataState.error"></div>
                        <div x-show="metadataState.result" class="mt-2 text-xs space-y-1">
                            <template x-for="(val, key) in metadataState.result.basic" :key="key">
                                <div class="flex justify-between"><span class="text-gray-500" x-text="key"></span><span class="font-medium text-gray-800" x-text="val"></span></div>
                            </template>
                            <div class="pt-1" x-show="Object.keys(metadataState.result.exif || {}).length">
                                <h5 class="text-xs font-semibold text-gray-700 mb-1">EXIF</h5>
                                <template x-for="(val, key) in metadataState.result.exif" :key="'exif-' + key">
                                    <div class="flex justify-between"><span class="text-gray-500" x-text="key"></span><span class="font-medium text-gray-800" x-text="val"></span></div>
                                </template>
                            </div>
                            <div class="pt-1">
                                <h5 class="text-xs font-semibold text-gray-700 mb-1">Fingerprints</h5>
                                <template x-for="(val, key) in metadataState.result.fingerprints" :key="'fp-' + key">
                                    <div class="flex justify-between"><span class="text-gray-500" x-text="key"></span><span class="font-mono break-all text-gray-800" x-text="val"></span></div>
                                </template>
                            </div>
                            <p x-show="metadataState.result.warnings && metadataState.result.warnings.length" class="text-xxs text-yellow-700 bg-yellow-100 p-1 rounded mt-1" x-text="metadataState.result.warnings.join('; ')"></p>
                            <div class="flex space-x-2 pt-1">
                                <button class="btn btn-secondary btn-sm" @click="exportImageMetadata('json')"><i class="fas fa-download mr-1"></i>JSON</button>
                                <button class="btn btn-secondary btn-sm" @click="exportImageMetadata('csv')"><i class="fas fa-file-csv mr-1"></i>CSV</button>
                            </div>
                        </div>
                    </div>

                    <div x-show="selectedImage" class="card p-4">
                        <h4 class="font-medium text-gray-900 mb-3"><i
                                class="fas fa-search mr-2 text-gray-500"></i>Reverse Search</h4>
                        <label class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-gray-50 rounded-md">
                            <input type="checkbox" x-model="searchOptions.socialOnly"
                                class="form-checkbox text-blue-600 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Search only on social media</span>
                        </label>
                    </div>

                    <div x-show="selectedImage" class="space-y-2">
                        <button class="btn btn-primary w-full btn-lg" :disabled="!canSearch || isSearching"
                            :class="{'opacity-50 cursor-not-allowed': !canSearch || isSearching}"
                            @click="startImageSearch()">
                            <span class="flex items-center justify-center">
                                <i x-show="!isSearching" class="fas fa-search mr-2"></i>
                                <div x-show="isSearching"
                                    class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2">
                                </div>
                                <span x-text="isSearching ? 'Searching...' : 'Start Search'"></span>
                            </span>
                        </button>
                    </div>

                    <div x-show="isSearching" class="space-y-2 pt-2">
                        <div class="progress-container">
                            <div class="progress-bar" :style="'width: ' + searchProgress + '%'"></div>
                        </div>
                        <p class="text-sm text-gray-600 text-center" x-text="searchStatus"></p>
                    </div>
                </div>
            </div>

            <div class="w-full lg:w-2/3 p-4 sm:p-6 overflow-y-auto bg-gray-50">
                <div x-show="visionState.result" class="card p-4 sm:p-5 mb-6" x-transition>
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="font-semibold text-gray-800 text-lg flex items-center">
                            <i class="fas fa-eye mr-2 text-blue-600"></i> Vision Analysis Result
                        </h3>
                        <button @click="clearVisionResult()"
                            class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div x-show="visionState.result.error"
                        class="text-sm text-red-700 bg-red-100 p-3 rounded-md border border-red-200"
                        x-text="visionState.result.error"></div>

                    <div x-show="!visionState.result.error" class="space-y-4">
                        <div class="prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap leading-relaxed bg-gray-50 p-3 rounded-lg border"
                            x-text="visionState.result.description"></div>

                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t">
                            <div class="flex items-center space-x-3">
                                <span><i class="fas fa-file-word mr-1"></i> <span
                                        x-text="visionState.result?.metadata?.wordCount || '0'"></span> words</span>
                                <span><i class="fas fa-stopwatch mr-1"></i> <span
                                        x-text="visionState.result?.metadata?.processingTime?.toFixed(2) || '0'"></span>s</span>
                                <span><i class="fas fa-dollar-sign mr-1"></i> Est. <span
                                        x-text="visionState.result?.metadata?.costEstimate?.toFixed(4) || '0'"></span></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click="copyVisionDescription()" class="btn btn-secondary btn-sm text-xs"><i
                                        class="fas fa-copy mr-1.5"></i>Copy</button>
                                <button @click="exportVisionResult()" class="btn btn-secondary btn-sm text-xs"><i
                                        class="fas fa-download mr-1.5"></i>Export</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div x-show="searchResults.length > 0 || isSearching"
                    class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 pb-3 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2 sm:mb-0">
                        Reverse Search Results
                        <span x-show="searchResults.length > 0 && !isSearching"
                            class="text-base font-normal text-gray-500"
                            x-text="'(' + filteredResults.length + ' of ' + searchResults.length + ' shown)'"></span>
                    </h2>

                    <div x-show="searchResults.length > 0 && !isSearching" class="flex items-center space-x-3">
                        <select class="form-input w-auto text-sm py-1.5 focus-ring" x-model="resultsFilter">
                            <option value="all">All Sources</option>
                            <option value="social">All Social Media</option>
                            <option value="facebook">Facebook</option>
                            <option value="instagram">Instagram</option>
                            <option value="twitter">Twitter/X</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="tiktok">TikTok</option>
                            <option value="youtube">YouTube</option>
                            <option value="pinterest">Pinterest</option>
                            <option value="reddit">Reddit</option>
                        </select>

                        <div class="flex bg-gray-200 rounded-lg p-0.5">
                            <button @click="viewMode = 'list'"
                                :class="viewMode === 'list' ? 'bg-white shadow-sm text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                class="p-1.5 rounded-md transition-colors">
                                <i class="fas fa-list"></i>
                            </button>
                            <button @click="viewMode = 'grid'"
                                :class="viewMode === 'grid' ? 'bg-white shadow-sm text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                class="p-1.5 rounded-md transition-colors">
                                <i class="fas fa-th"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div x-show="searchResults.length > 0 && !isSearching"
                    :class="viewMode === 'grid' ? 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5' : 'space-y-4'">
                    <template x-for="result in filteredResults" :key="result.link + Math.random()">
                        <div class="result-card p-4 flex flex-col hover-lift"
                            :class="result.is_social_media ? 'social-media ' + getSocialPlatform(result.link) : ''">
                            <div x-show="result.is_social_media" class="social-badge"
                                :class="getSocialPlatform(result.link)"
                                x-text="getSocialPlatform(result.link).replace('_', ' ')"></div>
                            <h3 class="font-semibold text-gray-800 mb-1 line-clamp-2 hover:text-blue-600 transition-colors cursor-pointer"
                                @click="openResult(result.link)" x-text="result.title"></h3>
                            <p class="text-xs text-gray-400 mb-2 break-all" x-text="result.displayed_link"></p>
                            <p class="text-sm text-gray-600 mb-3 line-clamp-3 flex-grow" x-text="result.snippet"></p>
                            <button @click="openResult(result.link)"
                                class="btn btn-secondary btn-sm w-full sm:w-auto mt-auto">
                                <i class="fas fa-external-link-alt mr-2"></i>
                                View Source
                            </button>
                        </div>
                    </template>
                    <div x-show="filteredResults.length === 0 && searchResults.length > 0"
                        class="col-span-full text-center py-10">
                        <i class="fas fa-filter text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600">No results match your current filter.</p>
                    </div>
                </div>

                <div x-show="isSearching && searchResults.length === 0"
                    class="flex flex-col items-center justify-center h-full text-center py-12">
                    <div class="progress-circular border-blue-500 mx-auto mb-6 h-12 w-12"></div>
                    <h3 class="text-xl font-medium text-gray-700" x-text="searchStatus || 'Searching for images...'">
                    </h3>
                    <p class="text-gray-500">This may take a moment.</p>
                </div>
                <div x-show="!isSearching && searchResults.length === 0 && selectedImage"
                    class="flex flex-col items-center justify-center h-full text-center py-12">
                    <i class="far fa-folder-open text-6xl text-gray-300 mb-6"></i>
                    <h3 class="text-2xl font-medium text-gray-700 mb-2">No Results Found</h3>
                    <p class="text-gray-500 max-w-md">Your search for the selected image did not return any results. Try
                        a different image or broaden search options.</p>
                </div>
                <div x-show="!selectedImage && !visionState.result"
                    class="flex flex-col items-center justify-center h-full text-center py-12">
                    <i class="fas fa-images text-6xl text-gray-300 mb-6"></i>
                    <h3 class="text-2xl font-medium text-gray-700 mb-2">No Image Selected</h3>
                    <p class="text-gray-500 max-w-md">Upload an image using the panel on the left to start Vision
                        Analysis or Reverse Search.</p>
                </div>
            </div>
        </div>

        <div x-show="activeTab === 'document-summary'" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="h-full">

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 p-4 sm:p-6 max-w-screen-2xl mx-auto">

                <div class="lg:col-span-3 space-y-4">
                    <div class="card bg-white rounded-lg shadow">
                        <div class="p-4">
                            <h3 class="font-medium text-gray-900 mb-3 flex items-center"><i
                                    class="fas fa-upload mr-2 text-blue-500"></i> Upload Documents</h3>
                            <div class="upload-area p-5 text-center text-sm" @click="browseDocumentFiles()"
                                @dragover.prevent="$el.classList.add('drag-active')"
                                @dragleave.prevent="$el.classList.remove('drag-active')"
                                @drop.prevent="handleDocumentDrop($event); $el.classList.remove('drag-active')">
                                <i class="fas fa-file-medical text-2xl text-gray-400 mb-2"></i>
                                <p class="text-gray-500 mb-2">Drag files or click to browse</p>
                                <p class="text-xs text-gray-400">PDF, DOCX, TXT, MD</p>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-lg shadow">
                        <div class="p-4">
                            <h3 class="font-medium text-gray-900 mb-3 flex items-center"><i
                                    class="fas fa-paragraph mr-2 text-blue-500"></i> Direct Text Input</h3>
                            <textarea x-model="directInputText" rows="4"
                                class="form-input w-full text-sm mb-2 focus-ring"
                                placeholder="Paste or type text..."></textarea>
                            <input type="text" x-model="directInputName"
                                class="form-input w-full text-sm mb-3 focus-ring"
                                placeholder="Optional: Name for this text">
                            <button @click="addDirectTextToQueue()" class="btn btn-secondary w-full btn-sm"
                                :disabled="!directInputText.trim()">
                                <i class="fas fa-plus mr-2"></i> Add Text to Queue
                            </button>
                        </div>
                    </div>

                    <!-- REFACTORED SUMMARY MODE SELECTION -->
                    <div class="card bg-white rounded-lg shadow">
                        <div @click="settingsPanels.summaryMode = !settingsPanels.summaryMode"
                            class="flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50 rounded-t-lg"
                            :class="!settingsPanels.summaryMode ? 'rounded-b-lg' : ''">
                            <div class="flex items-center">
                                <i class="fas fa-tasks mr-2 text-gray-500 w-5 text-center"></i>
                                <h3 class="font-medium text-sm text-gray-800">Chế độ Tóm tắt</h3>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500 mr-2">
                                    <span x-show="summaryMode === 'full'">Toàn bộ</span>
                                    <span x-show="summaryMode === 'percentage'">Theo %</span>
                                    <span x-show="summaryMode === 'word-count'">Theo số từ</span>
                                </span>
                                <i class="fas text-xs text-gray-400 transform transition-transform duration-200"
                                    :class="settingsPanels.summaryMode ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </div>
                        </div>
                        <div x-show="settingsPanels.summaryMode" x-collapse.duration.300ms
                            class="px-3 pb-3 pt-2 border-t border-gray-200">
                            <div class="space-y-3">
                                <!-- Full Summary Option -->
                                <div class="summary-radio-group">
                                    <input type="radio" id="summary-full" name="summaryMode" value="full"
                                        x-model="summaryMode" class="hidden">
                                    <label for="summary-full"
                                        class="flex items-center justify-between cursor-pointer p-2.5 rounded-md border border-gray-200 hover:bg-gray-50 transition-all">
                                        <div class="flex items-center space-x-2.5">
                                            <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center"
                                                :class="summaryMode === 'full' ? 'border-blue-600' : ''">
                                                <div x-show="summaryMode === 'full'"
                                                    class="w-2 h-2 rounded-full bg-blue-600"></div>
                                            </div>
                                            <span class="text-sm text-gray-700">Chế độ Tóm tắt</span>
                                        </div>
                                        <i class="fas fa-file-alt text-gray-400 text-xs"></i>
                                    </label>
                                </div>

                                <!-- Percentage Option -->
                                <div class="summary-radio-group">
                                    <input type="radio" id="summary-percentage" name="summaryMode" value="percentage"
                                        x-model="summaryMode" class="hidden">
                                    <label for="summary-percentage"
                                        class="flex items-center justify-between cursor-pointer p-2.5 rounded-md border border-gray-200 hover:bg-gray-50 transition-all">
                                        <div class="flex items-center space-x-2.5">
                                            <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center"
                                                :class="summaryMode === 'percentage' ? 'border-blue-600' : ''">
                                                <div x-show="summaryMode === 'percentage'"
                                                    class="w-2 h-2 rounded-full bg-blue-600"></div>
                                            </div>
                                            <span class="text-sm text-gray-700">Theo Phần Trăm</span>
                                        </div>
                                        <i class="fas fa-percentage text-gray-400 text-xs"></i>
                                    </label>
                                </div>

                                <!-- Percentage Slider - Conditional Display -->
                                <div x-show="summaryMode === 'percentage'"
                                    x-transition:enter="transition ease-out duration-200"
                                    x-transition:enter-start="opacity-0 transform -translate-y-2"
                                    x-transition:enter-end="opacity-100 transform translate-y-0"
                                    class="ml-6 p-3 bg-gray-50 rounded-md">
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-xs text-gray-600">Chi tiết</label>
                                        <span class="text-xs font-medium text-blue-600"
                                            x-text="detailLevel + '%'"></span>
                                    </div>
                                    <input type="range" x-model.number="detailLevel" min="10" max="90" step="5"
                                        class="form-slider w-full h-2 accent-blue-600">
                                    <div class="flex justify-between text-xs text-gray-400 mt-1">
                                        <span>10%</span>
                                        <span>50%</span>
                                        <span>90%</span>
                                    </div>
                                </div>

                                <!-- Word Count Option -->
                                <div class="summary-radio-group">
                                    <input type="radio" id="summary-word-count" name="summaryMode" value="word-count"
                                        x-model="summaryMode" class="hidden">
                                    <label for="summary-word-count"
                                        class="flex items-center justify-between cursor-pointer p-2.5 rounded-md border border-gray-200 hover:bg-gray-50 transition-all">
                                        <div class="flex items-center space-x-2.5">
                                            <div class="w-4 h-4 rounded-full border-2 border-gray-300 flex items-center justify-center"
                                                :class="summaryMode === 'word-count' ? 'border-blue-600' : ''">
                                                <div x-show="summaryMode === 'word-count'"
                                                    class="w-2 h-2 rounded-full bg-blue-600"></div>
                                            </div>
                                            <span class="text-sm text-gray-700">Theo Số Từ</span>
                                        </div>
                                        <i class="fas fa-sort-numeric-up text-gray-400 text-xs"></i>
                                    </label>
                                </div>

                                <!-- Word Count Input - Conditional Display -->
                                <div x-show="summaryMode === 'word-count'"
                                    x-transition:enter="transition ease-out duration-200"
                                    x-transition:enter-start="opacity-0 transform -translate-y-2"
                                    x-transition:enter-end="opacity-100 transform translate-y-0"
                                    class="ml-6 p-3 bg-gray-50 rounded-md">
                                    <label class="text-xs text-gray-600 mb-2 block">Giới hạn số từ</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="number" x-model.number="wordCountLimit" min="50" max="5000"
                                            step="50" class="form-input text-sm py-1 px-2 w-24 text-center focus-ring">
                                        <span class="text-xs text-gray-500">từ</span>
                                    </div>
                                    <p class="text-xs text-gray-400 mt-1">Min: 50, Max: 5000</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-lg shadow">
                        <div @click="settingsPanels.processing = !settingsPanels.processing"
                            class="flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50 rounded-t-lg"
                            :class="!settingsPanels.processing ? 'rounded-b-lg' : ''">
                            <div class="flex items-center">
                                <i class="fas fa-cogs mr-2 text-gray-500 w-5 text-center"></i>
                                <h3 class="font-medium text-sm text-gray-800">Processing Mode</h3>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500 mr-2 capitalize" x-text="processingMode"></span>
                                <i class="fas text-xs text-gray-400 transform transition-transform duration-200"
                                    :class="settingsPanels.processing ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </div>
                        </div>
                        <div x-show="settingsPanels.processing" x-collapse.duration.300ms
                            class="px-3 pb-3 pt-2 border-t border-gray-200">
                            <div class="space-y-1.5">
                                <label
                                    class="flex items-center space-x-2.5 cursor-pointer p-1.5 rounded-md hover:bg-gray-100 transition-colors">
                                    <input type="radio" name="processingMode" value="individual"
                                        x-model="processingMode"
                                        class="form-checkbox text-blue-600 focus:ring-offset-0 focus:ring-blue-500 focus-ring h-4 w-4">
                                    <span class="text-sm text-gray-700">Individual Analysis</span>
                                </label>
                                <label
                                    class="flex items-center space-x-2.5 cursor-pointer p-1.5 rounded-md hover:bg-gray-100 transition-colors">
                                    <input type="radio" name="processingMode" value="batch" x-model="processingMode"
                                        class="form-checkbox text-blue-600 focus:ring-offset-0 focus:ring-blue-500 focus-ring h-4 w-4">
                                    <span class="text-sm text-gray-700">Batch Synthesis (Files Only)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-lg shadow p-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-robot text-gray-500 w-5 text-center"></i>
                            <h3 class="font-medium text-sm text-gray-800">Enable AI Summarization</h3>
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only" x-model="useAI">
                            <div class="toggle-label block bg-gray-200 w-10 h-5 rounded-full relative">
                                <div class="toggle-ball absolute left-0.5 top-0.5 bg-white w-4 h-4 rounded-full shadow transform"
                                    :class="useAI ? 'translate-x-full' : ''"></div>
                            </div>
                        </label>
                    </div>

                    <div class="card bg-white rounded-lg shadow">
                        <div @click="settingsPanels.language = !settingsPanels.language"
                            class="flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50"
                            :class="!settingsPanels.language ? 'rounded-lg' : 'rounded-t-lg'">
                            <div class="flex items-center">
                                <i class="fas fa-language mr-2 text-gray-500 w-5 text-center"></i>
                                <h3 class="font-medium text-sm text-gray-800">Language</h3>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500 mr-2"
                                    x-text="targetLanguage ? targetLanguage.toUpperCase() : 'Original'"></span>
                                <i class="fas text-xs text-gray-400 transform transition-transform duration-200"
                                    :class="settingsPanels.language ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </div>
                        </div>
                        <div x-show="settingsPanels.language" x-collapse.duration.300ms
                            class="px-3 pb-3 pt-2 border-t border-gray-200">
                            <select id="targetLanguage" x-model="targetLanguage"
                                class="form-input w-full text-sm py-1.5 focus-ring">
                                <option :value="null">Original Language</option>
                                <option value="en">English</option>
                                <option value="vi">Vietnamese</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="es">Spanish</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary w-full btn-lg sticky bottom-4 z-20 shadow-lg"
                        :disabled="!canProcess || isProcessing"
                        :class="{'opacity-60 cursor-not-allowed': !canProcess || isProcessing}"
                        @click="startProcessing()">
                        <i x-show="!isProcessing" class="fas fa-play mr-2"></i>
                        <div x-show="isProcessing"
                            class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2">
                        </div>
                        <span x-text="isProcessing ? 'Processing...' : 'Start Processing'"></span>
                    </button>

                    <div class="card bg-white rounded-lg shadow">
                        <div @click="settingsPanels.queue = !settingsPanels.queue"
                            class="flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50"
                            :class="!settingsPanels.queue ? 'rounded-lg' : 'rounded-t-lg'">
                            <div class="flex items-center">
                                <i class="fas fa-list-ol mr-2 text-gray-500 w-5 text-center"></i>
                                <h3 class="font-medium text-sm text-gray-800">Processing Queue</h3>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500 mr-2"
                                    x-text="'(' + processingQueue.length + ' items)'"></span>
                                <i class="fas text-xs text-gray-400 transform transition-transform duration-200"
                                    :class="settingsPanels.queue ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </div>
                        </div>
                        <div x-show="settingsPanels.queue" x-collapse.duration.300ms
                            class="border-t border-gray-200 max-h-48 overflow-y-auto styled-scrollbar">
                            <div x-show="processingQueue.length > 0" class="p-2 space-y-1.5">
                                <template x-for="item in processingQueue" :key="item.id">
                                    <div class="flex items-center justify-between p-2 rounded-md"
                                        :class="{ 'bg-blue-50 ring-1 ring-blue-200': activePreviewFileId === item.id, 'hover:bg-gray-100': activePreviewFileId !== item.id }"
                                        @click="setActivePreviewFile(item.id)">
                                        <div class="flex items-center space-x-2 flex-1 min-w-0">
                                            <i :class="item.isDirectText ? 'fas fa-keyboard' : 'fas fa-file-alt'"
                                                class="text-gray-400 text-sm flex-shrink-0 w-4 text-center"></i>
                                            <div class="flex-1 min-w-0">
                                                <p class="text-xs font-medium text-gray-700 truncate"
                                                    x-text="item.name"></p>
                                                <p class="text-xs text-gray-500"
                                                    x-text="item.type + ' - ' + formatFileSize(item.size)"></p>
                                            </div>
                                            <span
                                                class="text-xs px-1.5 py-0.5 rounded-full whitespace-nowrap font-medium flex-shrink-0"
                                                :class="{
                                                    'bg-blue-100 text-blue-600': item.status === 'Ready',
                                                    'bg-yellow-100 text-yellow-600 animate-pulse': item.status === 'Processing...',
                                                    'bg-green-100 text-green-600': item.status === 'Completed',
                                                    'bg-red-100 text-red-600': item.status === 'Error'
                                                  }" x-text="item.status"></span>
                                        </div>
                                        <button @click.stop="removeFromQueue(item.id)" title="Remove"
                                            class="ml-1.5 text-gray-400 hover:text-red-500 p-0.5 rounded-full hover:bg-red-100 focus:outline-none flex-shrink-0">
                                            <i class="fas fa-times text-xs"></i>
                                        </button>
                                    </div>
                                </template>
                            </div>
                            <p x-show="processingQueue.length === 0" class="text-xs text-gray-400 text-center p-3">Queue
                                is empty.</p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-6 space-y-6">
                    <div class="card p-4 min-h-[calc(100vh-12rem)] flex flex-col shadow-lg bg-white">
                        <div class="flex items-center justify-between border-b border-gray-200 pb-2 mb-4">
                            <div class="flex space-x-1">
                                <button @click="contentTab = 'original'"
                                    :class="contentTab === 'original' ? 'tab-button active text-sm' : 'tab-button text-sm'"
                                    class="px-3 py-1.5 font-medium">
                                    <i class="fas fa-file-lines mr-1.5"></i> Original Content
                                </button>
                                <button
                                    @click="contentTab = 'results'; if (analysisData && analysisData.common_words) renderWordCloud(analysisData.common_words);"
                                    :class="contentTab === 'results' ? 'tab-button active text-sm' : 'tab-button text-sm'"
                                    class="px-3 py-1.5 font-medium">
                                    <i class="fas fa-wand-magic-sparkles mr-1.5"></i> AI Results
                                    <span x-show="aiResult && !isProcessing"
                                        class="text-xs ml-0.5 bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded-full">1</span>
                                </button>
                                <button
                                    @click="contentTab = 'analysis'; if (analysisData && analysisData.common_words && !analysisData.error) renderWordCloud(analysisData.common_words);"
                                    :class="contentTab === 'analysis' ? 'tab-button active text-sm' : 'tab-button text-sm'"
                                    class="px-3 py-1.5 font-medium">
                                    <i class="fas fa-chart-simple mr-1.5"></i> Analysis
                                </button>
                            </div>
                            <button @click="copyContentToClipboard()" title="Copy current tab's content"
                                class="btn btn-secondary btn-sm text-xs">
                                <i class="fas fa-copy mr-1.5"></i> Copy
                            </button>
                        </div>

                        <div class="flex-grow overflow-y-auto pr-2 styled-scrollbar">
                            <div x-show="contentTab === 'original'">
                                <div x-show="isLoading && loadingTitle === 'Loading Preview'"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <div class="progress-circular border-blue-500 mx-auto mb-4 h-10 w-10"></div>
                                    <p class="text-gray-600 text-lg font-medium"
                                        x-text="loadingMessage || 'Loading document content...'"></p>
                                </div>
                                <div x-show="!originalContent && !(isLoading && loadingTitle === 'Loading Preview')"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <i class="fas fa-file-alt text-5xl text-gray-300 mb-5"></i>
                                    <p class="text-gray-500 text-lg">
                                        <span x-show="processingQueue.length === 0">Upload documents or add text to get
                                            started.</span>
                                        <span x-show="processingQueue.length > 0">Select an item from the queue to
                                            preview its content.</span>
                                    </p>
                                </div>
                                <div x-show="originalContent && !(isLoading && loadingTitle === 'Loading Preview')"
                                    class="prose prose-sm max-w-none text-gray-800 whitespace-pre-wrap leading-relaxed selection:bg-yellow-200 selection:text-black"
                                    x-html="highlightSearchTerm(originalContent, searchTerm)"></div>
                            </div>

                            <div x-show="contentTab === 'results'" class="space-y-5">
                                <div x-show="isProcessing && !aiResult"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <div class="progress-circular border-blue-500 mx-auto mb-4 h-10 w-10"></div>
                                    <p class="text-gray-600 text-lg font-medium">Generating AI results...</p>
                                </div>
                                <div x-show="!isProcessing && !aiResult && activePreviewFileId"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <i class="fas fa-robot text-5xl text-gray-300 mb-5"></i>
                                    <p class="text-gray-500 text-lg">No AI results for this item.</p>
                                    <p class="text-gray-400">Process the item with AI models enabled to see summaries.
                                    </p>
                                </div>
                                <div x-show="!activePreviewFileId && !aiResult"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <i class="fas fa-hand-pointer text-5xl text-gray-300 mb-5"></i>
                                    <p class="text-gray-500 text-lg">Select an item and process it.</p>
                                </div>
                                <div x-show="aiResult" class="card p-3.5 bg-gray-50/60 border border-gray-200/80 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center text-base">
                                        <i :class="getAIModelIcon(aiResult.model) + ' mr-2 text-lg text-blue-600'"></i>
                                        <span x-text="aiResult.model + ( (processingMode === 'batch' || (activePreviewFileId && processingQueue.find(i=>i.id === activePreviewFileId)?.isBatchMember)) && (aiResult.model !== 'Error') ? ' Batch Synthesis' : ' Summary')"></span>
                                    </h4>
                                    <div x-show="aiResult.is_error" class="text-sm text-red-700 bg-red-100 p-2.5 rounded-md border border-red-200 whitespace-pre-wrap" x-text="aiResult.content"></div>
                                    <div x-show="!aiResult.is_error" class="prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap leading-relaxed selection:bg-yellow-200 selection:text-black" x-html="highlightSearchTerm(aiResult.content, searchTerm)"></div>
                                </div>
                            </div>

                            <div x-show="contentTab === 'analysis'">
                                <div x-show="isProcessing && !analysisData"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <div class="progress-circular border-blue-500 mx-auto mb-4 h-10 w-10"></div>
                                    <p class="text-gray-600 text-lg font-medium">Performing text analysis...</p>
                                </div>
                                <div x-show="!isProcessing && !analysisData && activePreviewFileId"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <i class="fas fa-chart-pie text-5xl text-gray-300 mb-5"></i>
                                    <p class="text-gray-500 text-lg">No analysis data for this item.</p>
                                    <p class="text-gray-400">Process an item to view text analysis metrics.</p>
                                </div>
                                <div x-show="!activePreviewFileId && !analysisData"
                                    class="flex flex-col items-center justify-center h-64 text-center">
                                    <i class="fas fa-hand-pointer text-5xl text-gray-300 mb-5"></i>
                                    <p class="text-gray-500 text-lg">Select an item and process it.</p>
                                </div>
                                <div x-show="analysisData" class="space-y-4">
                                    <div x-show="analysisData.error"
                                        class="col-span-full text-sm text-red-700 bg-red-100 p-2.5 rounded-md border border-red-200"
                                        x-text="'Analysis Error: ' + analysisData.error"></div>
                                    <div x-show="!analysisData.error">
                                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm mb-4">
                                            <div class="card p-3.5 bg-gray-50/30 text-center rounded-lg">
                                                <div class="text-xs text-gray-500 uppercase tracking-wider">Words</div>
                                                <div class="text-2xl font-semibold text-blue-600 mt-0.5"
                                                    x-text="analysisData.word_count?.toLocaleString() || 'N/A'"></div>
                                            </div>
                                            <div class="card p-3.5 bg-gray-50/30 text-center rounded-lg">
                                                <div class="text-xs text-gray-500 uppercase tracking-wider">Sentences
                                                </div>
                                                <div class="text-2xl font-semibold text-green-600 mt-0.5"
                                                    x-text="analysisData.sentence_count?.toLocaleString() || 'N/A'">
                                                </div>
                                            </div>
                                            <div class="card p-3.5 bg-gray-50/30 text-center rounded-lg">
                                                <div class="text-xs text-gray-500 uppercase tracking-wider">Paragraphs
                                                </div>
                                                <div class="text-2xl font-semibold text-purple-600 mt-0.5"
                                                    x-text="analysisData.paragraph_count?.toLocaleString() || 'N/A'">
                                                </div>
                                            </div>
                                            <div class="card p-3.5 bg-gray-50/30 text-center rounded-lg">
                                                <div class="text-xs text-gray-500 uppercase tracking-wider">Avg. Word
                                                    Len</div>
                                                <div class="text-xl font-semibold text-orange-600 mt-0.5"
                                                    x-text="analysisData.avg_word_length ? Number(analysisData.avg_word_length).toFixed(1) : 'N/A'">
                                                </div>
                                            </div>
                                            <div
                                                class="card p-3.5 bg-gray-50/30 text-center rounded-lg col-span-2 sm:col-span-1">
                                                <div class="text-xs text-gray-500 uppercase tracking-wider">Avg. Sent.
                                                    Len</div>
                                                <div class="text-xl font-semibold text-teal-600 mt-0.5"
                                                    x-text="analysisData.avg_sentence_length ? Number(analysisData.avg_sentence_length).toFixed(1) + ' words' : 'N/A'">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card p-4 bg-gray-50/30 rounded-lg"
                                            x-show="analysisData.common_words && analysisData.common_words.length > 0">
                                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Most Common Words (Top
                                                15)</h4>
                                            <div class="chart-container h-64 sm:h-72">
                                                <canvas id="wordFrequencyChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-3 space-y-4">
                    <div class="card p-3.5 shadow-md bg-white">
                        <h3 class="font-semibold text-gray-800 mb-2 text-sm flex items-center"><i
                                class="fas fa-info-circle mr-2 text-gray-400"></i>Active Item Details</h3>
                        <div x-show="activePreviewFileId && processingQueue.find(f => f.id === activePreviewFileId)"
                            class="text-xs space-y-1">
                            <p><strong class="text-gray-500">Name:</strong> <span class="text-blue-600 break-all"
                                    x-text="processingQueue.find(f => f.id === activePreviewFileId)?.name"></span></p>
                            <p><strong class="text-gray-500">Size:</strong> <span class="text-gray-600"
                                    x-text="formatFileSize(processingQueue.find(f => f.id === activePreviewFileId)?.size)"></span>
                            </p>
                            <p><strong class="text-gray-500">Type:</strong> <span class="text-gray-600"
                                    x-text="processingQueue.find(f => f.id === activePreviewFileId)?.type"></span></p>
                            <p><strong class="text-gray-500">Status:</strong>
                                <span class="font-medium" :class="{
                                        'text-blue-600': processingQueue.find(f => f.id === activePreviewFileId)?.status === 'Ready',
                                        'text-yellow-600 animate-pulse': processingQueue.find(f => f.id === activePreviewFileId)?.status === 'Processing...',
                                        'text-green-600': processingQueue.find(f => f.id === activePreviewFileId)?.status === 'Completed',
                                        'text-red-600': processingQueue.find(f => f.id === activePreviewFileId)?.status === 'Error'
                                      }" x-text="processingQueue.find(f => f.id === activePreviewFileId)?.status">
                                </span>
                            </p>
                        </div>
                        <div x-show="!activePreviewFileId && processingQueue.length > 0"
                            class="text-xs text-gray-500 py-2 text-center">Select an item from the queue.</div>
                        <div x-show="processingQueue.length === 0" class="text-xs text-gray-500 py-2 text-center">Add
                            files or text to begin.</div>
                    </div>

                    <div class="card p-3.5 shadow-md bg-white">
                        <h3 class="font-semibold text-gray-800 mb-2 text-sm flex items-center">
                            <i class="fas fa-search-plus mr-2 text-gray-400"></i>Content Search
                        </h3>
                        <input type="text" x-model="searchTerm" @input.debounce.300ms="searchTerm = $event.target.value"
                            placeholder="Search in displayed content..."
                            class="form-input w-full text-xs py-1.5 focus-ring">
                        <p class="text-xs text-gray-400 mt-1.5">Highlights terms in content tabs.</p>
                    </div>

                    <div class="card p-3.5 shadow-md bg-white">
                        <h3 class="font-semibold text-gray-800 mb-2 text-sm flex items-center"><i
                                class="fas fa-tachometer-alt mr-2 text-gray-400"></i>Session Stats</h3>
                        <div class="space-y-1.5 text-xs">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-500">Processed Items:</span>
                                <span class="font-semibold text-gray-700 text-base" x-text="stats.processed"></span>
                            </div>
                        </div>
                        <p x-show="isProcessing" class="text-xs text-yellow-600 mt-2 animate-pulse flex items-center"><i
                                class="fas fa-spinner fa-spin mr-1.5"></i>Processing active...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer
        class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-top-md transition-all duration-300 z-40"
        :class="logPanelExpanded ? 'h-48 sm:h-64' : 'h-10 sm:h-12'">
        <div class="flex items-center justify-between px-4 sm:px-6 py-2 sm:py-3 cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors"
            @click="logPanelExpanded = !logPanelExpanded">
            <div class="flex items-center space-x-3">
                <i class="fas fa-terminal text-gray-500 text-sm"></i>
                <span class="text-xs sm:text-sm font-medium text-gray-700">System Logs</span>
                <span class="px-2 py-0.5 text-xs bg-gray-200 text-gray-700 rounded-full"
                    x-text="logEntries.length + (logEntries.length >= 200 ? '+' : '') + ' entries'"></span>
            </div>
            <i class="fas text-gray-500 text-sm transform transition-transform duration-200"
                :class="logPanelExpanded ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
        </div>
        <div x-show="logPanelExpanded" x-collapse.duration.300ms
            class="log-panel h-[calc(100%-2.5rem)] sm:h-[calc(100%-3rem)] overflow-y-auto px-4 sm:px-6 py-2 bg-slate-800 styled-scrollbar-dark">
            <template x-for="entry in logEntries" :key="entry.id">
                <div class="log-entry text-xs font-mono" :class="{ 
                        'text-emerald-400': entry.level === 'SUCCESS',
                        'text-sky-400': entry.level === 'INFO', 
                        'text-amber-400': entry.level === 'WARNING', 
                        'text-rose-400': entry.level === 'ERROR' 
                     }">
                    <span class="log-timestamp text-slate-500 mr-2 select-none" x-text="entry.timestamp"></span>
                    <span class="font-semibold mr-1 select-none" x-text="'[' + entry.level + ']'"></span>
                    <span class="whitespace-pre-wrap" x-text="entry.message"></span>
                </div>
            </template>
        </div>
    </footer>

    <div x-show="isLoading"
        class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[9999] transition-opacity"
        x-transition:enter="ease-out duration-200" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-150"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" aria-labelledby="loading-title"
        role="dialog" aria-modal="true" style="display: none;">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-xs w-full mx-4 text-center">
            <div class="progress-circular mx-auto mb-4 border-blue-500 h-10 w-10"></div>
            <div id="loading-title" class="font-semibold text-lg text-gray-800 mb-1"
                x-text="loadingTitle || 'Loading...'"></div>
            <div class="text-sm text-gray-600" x-text="loadingMessage || 'Please wait a moment.'"></div>
        </div>
    </div>

    <div x-data="{}" x-init="
        if (typeof Notifications === 'undefined') {
            // Simple fallback if Notifications.js is not loaded
            window.Notifications = { show: (type, title, message) => $dispatch('show-fallback-notification', { type, title, message }) };
        }
    ">
        <div x-show="notification.show" @custom-show-fallback-notification.window="
            notification.type = $event.detail.type;
            notification.title = $event.detail.title;
            notification.message = $event.detail.message;
            notification.show = true;
            setTimeout(() => notification.show = false, 5000);
        " x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-y-2 sm:translate-y-0 sm:translate-x-full"
            x-transition:enter-end="opacity-100 transform translate-y-0 sm:translate-x-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 transform translate-y-0 sm:translate-x-0"
            x-transition:leave-end="opacity-0 transform translate-y-2 sm:translate-y-0 sm:translate-x-full"
            class="fixed top-20 sm:top-24 right-4 z-[9990] w-full max-w-sm sm:max-w-md" role="alert"
            aria-live="assertive" style="display: none;">
            <div class="notification shadow-2xl rounded-lg overflow-hidden border-l-4" :class="{
                    'bg-green-50 border-green-500': notification.type === 'success',
                    'bg-red-50 border-red-500': notification.type === 'error',
                    'bg-yellow-50 border-yellow-500': notification.type === 'warning',
                    'bg-blue-50 border-blue-500': notification.type === 'info'
                }">
                <div class="p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mt-0.5">
                            <i class="fas text-xl" :class="{
                                    'fa-check-circle text-green-500': notification.type === 'success',
                                    'fa-times-circle text-red-500': notification.type === 'error',
                                    'fa-exclamation-triangle text-yellow-500': notification.type === 'warning',
                                    'fa-info-circle text-blue-500': notification.type === 'info'
                            }"></i>
                        </div>
                        <div class="ml-3 flex-1" style="background: yellow;">
                            <div
                                style="display: flex; flex-direction: row; align-items: baseline; background: lightblue;">
                                <span style="background: lightgreen;" class="font-semibold text-gray-900"
                                    x-text="notification.title"></span>
                                <span style="background: lightcoral; margin-left: 8px;" class="text-sm text-gray-700"
                                    x-text="notification.message"></span>
                            </div>
                        </div>
                        <div class="ml-4 flex-shrink-0">
                            <button @click="notification.show = false"
                                class="inline-flex text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400">
                                <span class="sr-only">Close</span>
                                <i class="fas fa-times text-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="text/javascript" src="/eel.js"></script>
    <script src="js/components/common.js"></script>
    <script src="js/components/image-vision.js"></script>
    <script src="js/components/image-metadata.js"></script>
    <script src="js/utils/notifications.js"></script>
    <script src="js/utils/chart-renderer.js"></script>
    <script src="js/app.js"></script>

</body>

</html>